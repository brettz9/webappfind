**NOTE: This page needs to be updated to reflect current behavior!**

## User guide (for end-users)

(For command line usage, see the API below instead.)

### Usage of the executables on your OS desktop

*Note that the following steps are only necessary if you are not using
[Executable Builder](../executable-builder/README.md). The Executable Builder
component can assist to associate default file types to (web)
applications without your needing to find the path of these executables
as WebAppFind otherwise requires.*

You must first install the WebExtensions add-on (and installer) so that
the following steps will work (the add-on has not yet been submitted
to the Add-ons site, so for now, you will have to build the add-on
from source).

1. Right-click on a file and...
    1. If you want to use WebAppFind without disturbing your defaults
        for that file extension, select "Open With"->"Other..." and
        if you want to always open that particular file with WebAppFind,
        you can also check "Always Open With" in the resulting dialog.
        (Alternatively, you can select "Get Info" (`command-I`) and change
        the value in the "Open with" pull-down and then the file can just
        be double-clicked in the future--assuming you did not already use
        [Executable Builder](../executable-builder/README.md) to do this for you.)
        <!--
        Note: on Windows, when available again, the following instructions can be used:

        select "Open with"->"Choose default program..." if present (or if
        not present, open the file and choose "Select a program
        from a list of installed programs") and then make sure "Always use
        the selected program to open this kind of file" is not checked.
        -->
    1. If you always want to use WebAppFind when handling files with the same
        extension as this file (and just be able to double-click such files
        when opening them in the future), you can select "Get Info"
        (`command-I`) and change the value in the "Open with" pull-down and
        then click "Change All.." to apply to all such files of that file
        extension.
        <!--
        TODO: on Windows, when available again, the following instructions can be used:

        click "Properties", then click "Change..." next to
        "Opens with:" in the General tab of the dialog.
        -->
<!--
TODO: on Windows, when available again, the following instructions can be used:
1. Click "Browse".
-->
1. Navigate to an executable built following the instructions in the section
    "Executable builder" <!-- (Or, if
    you prefer, you can use one of the pre-built binaries includes in the `bin`
    folder of this repository, though see the above-mentioned section anyways
    on the differences of functionality in those binaries).-->
1. Select "Ok".
1. If you used "Open with" (as per step 1.1 above), your file should have
    already opened with WebAppFind. If you opted for "Get Info" in step 1
    <!-- TODO: On Windows, once implemented "Properties" -->
    you should now be able to double-click the file (or any file possessing
    the same extension if you followed step 1.2) to open it with WebAppFind.

If an edit permission is granted <!-- (`web+local` protocol) is enabled -->
and open and then disabled in
the same session, it will keep having save access (though within that
window session only). One must currently close any open tabs for that
web application if one no longer wishes to allow access (though as noted
elsewhere in this documentation, the app only has access to the files to
which you granted access).

## Executable builder (building executables for use on OS desktop)

An AppleScript file can be generated by invoking the `native-app`
executable (or script) added by the installer with the arguments below,
allowing one to pass predetermined or run-time parameters through
WebAppFind, along with a local file to be opened by a number of methods
("open with", as a default file association, via drag-and-drop (including
if placed conveniently on one's dock), command line, or a file optionally
baked into the script).

In place of a local file, if the generated AppleScript is called with
no arguments (including when placed on the dock), a file selector may
pop-up to determine the file whose contents will be sent to your web
applications.

If the AppleScript is invoked on the command line, one can invoke with:

<!--
```bash
open ./webappfind-as.app --args /Users/brett/myFile.txt
```
-->
```bash
osascript ./webappfind-as.app /Users/brett/myFile.txt
```

or to bring up the file selector, just:
<!--
```bash
open ./webappfind-as.app
```
-->
```bash
osascript ./webappfind-as.app
```

You can then follow the instructions in
"Usage of the executables on your OS desktop"
to use "Open with" or to associate a specific file or all files of a
certain extension with the web app that will be chosen as a result of
running this executable.

Alternatively or in addition, you can drag this file to your Dock,
Favorites, etc. so as to be able to drag files onto it for opening
(or to just click it to open any hard-baked file or to get the file
dialog otherwise).

See [executable-builder/README.md](../executable-builder/README.md) for more.

### Arguments

- **method** - Required. Must be set to "build-openwith-executable".
- **executableName** - Name (used in "Open with...")
- **executablePath** - Path for executable.
- **id** - Value for `CFBundleIdentifier`, uniquely identifying app to the OS.
- **file** - Optional hard-baking of a file. If this argument is not included,
    the generated script will check for the presence of an argument to the
    script to serve as the file to pass to the web application. If no argument
    is passed to the *generated script*, its absence will trigger a file
    dialog.
- **string** - Hard-coded string to pass to app (in place of file); if `true`,
    `"true"`, or `"on"`, the string will be accepted as an argument at run-time
    rather than being baked in.
- **mode** - Optional mode for invoking the web app on your contents, either
    "view" (readonly), "edit" (read and write), "shell", or "none".
    Default is "view".
- **binary** - Optional to indicate a program needing to open a file in
    binary mode, such as images, sound files, or videos.
    <!--
    Todo: Re-enable when restoring filetypes.json
    The `filetypes.json` file can be used to force "binary" or not for
    the respective view or edit mode.
    -->
- **site** - Baking in of a specific site to invoke with the
    designated file's contents. Currently required. <!--
    Todo: Re-enable following when restoring filetypes.json (and mention `site` only optional)
    Will check for local `filetypes.json`
    otherwise. -->
- **extensions** - Array used for `CFBundleTypeExtensions`
- **contentTypes** - Array used for `CFBundleTypeOSTypes`
- **extensionsDefaults** - Array of `extension`s to pass to `addOrReplaceExtensionHandler`. See [launchServiceHandlers.js](../launchServiceHandlers.js).
- **contentTypesDefaults** - Array of `contentType`s to pass to `addOrReplaceContentTypeHandler`. See [launchServiceHandlers.js](../launchServiceHandlers.js).
- **args** - Optional. Any (JSON) arguments to pass to the web applications
    `onmessage` listener data object (under `args`).
- **log** - Whether to log to stdout.
- **filePicker** - Whether to show a file picker
- **fileSelectMessage** - When the generated script does not have a baked-in
    file and no file argument is passed to it, this argument will determine
    the message shown in the resulting file dialog.
- **fileSelectType** - When the generated script does not have a baked-in file
    and no file argument is passed to it, this argument, if present, will have
    the script insist on a particular file type in the resulting file dialog.
    Must be an extension string without the leading period (e.g., "js" for
    ".js" JavaScript files) or a
    [Uniform Type Identifier](https://en.wikipedia.org/wiki/Uniform_Type_Identifier),
    e.g., "public.image" or "com.apple.iwork.pages.sffpages".

## Command line communication with add-on

In order to pass a file into the add-on (which can use any arguments and its
heuristics to determine the specific website to open and in what manner),
the `native-app.js` file should be invoked with `--method=client` and
optionally with
`--file="..."`, `--mode="view|edit"`, `--site="http://..."`, `--args="..."`.
See "Executable builder" "Arguments" section for how these
optional methods will be used.

----
TODO: Update this section and integrate

String (or if not passing anything and just want executable to open a URL)

WebAppFind is triggered through command line
arguments passed to a WebExtensions browser (or Chrome) and handled by
the WebAppFind add-on.

It is my goal to complete work on
[Executable Builder](https://github.com/brettz9/executable-builder) to
facilitate the building of executables (probably batch scripts tied to
cmd.exe) with icon for task bar usage, etc., but currently one must
either use (or build) the executables included in the repository or call
the command line oneself.

The following process is subject to change and may potentially even
be scrapped altogether if another approach is found to be easier for
streamlining cross-browser invocation, but currently this API is available
if someone wishes to build their own executables using the API or to
simply be able to run commands manually from the command line.

* `-webappdoc <path>` - Indicates the path of the file which will be made
    available to the web application (with the privileges designated by
    `-webappmode`)
* `-mode <mode>` Indicates the fundamental mode under which the file
    will be opened up to the web app (i.e., "-mode view",
    "-mode view", "-mode edit", or "-mode edit -binary").
* `-webappcustommode <custom mode>` - Indicates a mode that supplements
    the fundamental mode (e.g., "source" added to the fundamental mode,
    "view" in order to specify that the document is being opened so as to
    view the source code). Custom modes will immediately follow the mode
    within the protocol. (Note that this API is expected to change)
* `-remote "openurl(about:newtab)"` - This built-in Mozilla command line
    API allows Firefox (unlike "-silent") to gain focus without additional
    instructions to Windows. If the tab is determined to not be needed
    (e.g., if the user has opted to allow desktop opening of the file when
    no protocols are found), the add-on will simply auto-close the tab
    that this parameter opens. <!-- To-do: make this cross-browser -->

<!--
Todo: Re-enable when restoring filetypes.json
## `filetypes.json`

For an explanation of the `filetypes.json` format (e.g., if you wish to tweak
it as a user), see the [Developer-Guide](./Developer-Guide.md).
-->

# Command line usage

## Directly interacting with WebAppFind

Similar to the AppleScript creation commands in the
[User Guide](./docs/User-Guide.md) (where relevant), except that `method`
should be `client` (instead of `build-openwith-executable`).

```
node native-app.js --method=client --file="path/to/my/file" --mode=view --binary=true --site=http://example.com --args='{"a":1, "b":2}'
```

(The executable installed by the installer may be referenced in place
of `node native-app.js`.)


## Building an AppleScript executable that can be used with "Open with..." to interact with WebAppFind

In addition to using the graphical Executable Builder (the "Exec" button
in the toolbar of the add-on), one may also build executables from the
command line.

See the [User Guide](./docs/User-Guide.md) for usage.

## Creating URL shortcuts

This functionality is not quite WebAppFind-related, but is provided
as a convenience.

```
node native-app.js --method=urlshortcut --path=/path/to/create.webloc --url="http://example.com"
```

<!--
NOTE: This is not currently working due to restrictions with
[browserAction.openPopup](https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/browserAction/openPopup);
it requires a user action to activate

Once the add-on is installed, the following can be used in calls to
browser in addition to browser's own flags.

- `node native-app.js --method=execbuildopen` - Open the Executable Builder dialog.

It is hoped that additional command line options will be added which
can cover the entire range of functionality available in the UI.
-->

## Tools and Comparisons

For tips for using with other tools and comparison to other similar tools,
see [Tools-and-Comparisons](./Tools-and-Comparisons.md)
